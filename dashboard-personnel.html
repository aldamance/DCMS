<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DENR-CENRO Diffun â€” Digital Client Management Dashboard</title>
  <link rel="icon" href="assets/denrlogo.png" type="image/svg+xml" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root{
      --green-900:#08331a;
      --green-700:#0b6137;
      --muted:#6b7280;
      --bg:#f7f9fb;
      --card:#ffffff;
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#f7fbf7 0%, #f7f9fb 100%);color:#0f172a}

    .app{display:flex;min-height:100vh}
    .sidebar{
      width:280px;
      background:var(--green-900);
      color:white;
      padding:20px 16px;
      display:flex;
      flex-direction:column;
      gap:20px;
      /* Main Sidebar Layout */
      position: sticky; top: 0; height: 100vh;
      z-index: 1000;
      transition: width .25s ease, transform .3s ease; /* Added transform transition */
      box-shadow:0 6px 18px rgba(3,10,7,0.15);
    }
    
    .brand{
        display:flex;
        gap:12px;
        align-items:center;
        min-height: 44px; /* Ensure brand section doesn't disappear */
    }
    .logo{width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700}
    .brand h1{font-size:15px;margin:0}
    .brand p{margin:0;font-size:11px;opacity:.92}

    nav{display:flex;flex-direction:column;gap:8px}
    .nav-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;cursor:pointer;transition:background .18s, transform .08s;user-select:none}
    .nav-item:hover{background:rgba(255,255,255,0.06);transform:translateX(4px)}
    .nav-item.active{background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03))}
    .nav-item svg{opacity:.95}

    .content{flex:1;padding:28px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px; flex-wrap: wrap;}
    
    /* New container for the title and the mobile menu button */
    .topbar-left {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .title{font-size:18px;font-weight:700}
    .subtitle{color:var(--muted);font-size:13px}
    
    /* Right side of the top bar */
    .topbar .row {
        flex-direction: column;
        align-items: flex-end; 
        gap: 12px;
    }

    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(16,24,40,0.06);}

    /* MODERN DIGITAL CLOCK STYLES */
    #realtime-datetime {
      text-align: center;
      font-family: 'Inter', 'DSEG7 Classic', monospace; 
      font-size: 24px; 
      font-weight: 700;
      color: var(--green-900); 
      margin-bottom: 0 !important; 
      padding: 8px 12px;
      background-color: #e2e8f0; 
      border-radius: 8px;
      letter-spacing: 1px; 
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      margin-right: 0 !important; 
    }

    .time-display {
        font-size: 32px; 
        color: var(--green-700); 
        font-weight: 900;
    }

    .date-display {
        font-size: 13px; 
        font-weight: 600;
        color: var(--muted);
        margin-top: 2px;
    }
    
    .actions{display:flex;gap:10px;justify-content:center;margin-top:8px}
    button{
        padding:10px 14px;
        border-radius:10px;
        border:0;
        background:var(--green-700);
        color:white;
        font-weight:600;
        cursor:pointer;
        transition:transform .12s, box-shadow .12s, background-color .12s;
        white-space: nowrap; 
    }
    
    /* Table Styles */
    #clientListContainer { overflow-x: auto; }
    table{width:100%;border-collapse:collapse;margin-top:12px;min-width: 700px;} 
    thead th{text-align:left;padding:12px 8px;color:var(--muted);font-size:13px;border-bottom:1px solid #eef5f7}
    tbody td{padding:12px 8px;border-bottom:1px solid #fbfcfd; font-size: 14px;}
    
    /* Search Bar Style */
    #search-input {
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      width: 100%;
      font-size: 14px;
      text-transform: none; 
    }

    /* Pagination */
    .pagination-controls {
        display:flex; 
        justify-content:center; 
        gap:10px; 
        margin-top:12px;
    }
    
    /* ======================================= */
    /* SPLASH SCREEN STYLES (FIXED) */
    /* ======================================= */
    #splash-intro {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg); /* Use the defined background color */
      z-index: 2000; /* Ensure it's above all other elements */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
      text-align: center;
    }
    
    #splash-intro h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--green-900);
      margin-bottom: 0;
    }
    
    #splash-intro h3 {
      font-size: 16px;
      font-weight: 400;
      color: var(--muted);
      margin-top: 5px;
    }
    /* Style for hidden splash screen */
    #splash-intro.hidden {
        opacity: 0;
        visibility: hidden;
    }
    
    /* ======================================= */
    /* MOBILE OPTIMIZATION MEDIA QUERIES */
    /* ======================================= */
    
    /* Tablet/Compact Desktop (900px to 601px) */
    @media (max-width: 900px) {
      /* Collapsed Sidebar */
      .sidebar{width:68px;padding:16px; position: static; height: auto;}
      .brand h1,.brand p{display:none}
      .app { flex-direction: column; } 
    }
    
    /* Mobile Phone Portrait (<= 600px) */
    @media (max-width: 600px) {
        .content {
            padding: 15px; 
        }
        
        /* 1. HIDE the sidebar by default and make it an overlay */
        .sidebar {
            width: 280px; /* Full width when open */
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            transform: translateX(-100%); /* Hide it off-screen */
            box-shadow: 6px 0 18px rgba(3, 10, 7, 0.35); /* Shadow on the side */
            padding: 20px 16px; 
        }
        
        /* 2. SHOW the sidebar when 'open' class is applied */
        .sidebar.open {
            transform: translateX(0);
        }
        
        /* 3. Show full brand text when menu is open */
        .sidebar.open .brand h1, .sidebar.open .brand p {
            display: block !important;
        }

        /* 4. Show the mobile menu button */
        #menu-toggle {
            display: block !important;
        }
        
        /* 5. Add an overlay when menu is open to dim content */
        .app.menu-open:after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999; 
        }

        /* Top Bar: Force stack layout for titles and actions */
        .topbar {
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .topbar-left {
            width: 100%;
            justify-content: flex-start; /* Align menu button and title */
        }
        
        .title {
            font-size: 16px;
        }

        /* Time & Sync Button Group */
        .topbar .row {
            width: 100%;
            flex-direction: row; 
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        /* Tables */
        table{min-width: 450px;}
        thead th, tbody td {
            padding: 8px 5px; 
            font-size: 13px; 
        }
        
        .pagination-controls button {
            font-size: 13px;
            padding: 8px 10px;
        }
        
        .developed-by {
            display: none;
        }
    }
  </style>
</head>
<body>
  <div id="splash-intro">
    <img src="assets/logo1.png" alt="DENR-CENRO Diffun Logo" style="width: 200px; height:auto; border-radius:12px;">
    <h1>DENR-CENRO Diffun</h1>
    <h3>Digital Client Management Dashboard</h3>
  </div>

  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <img src="assets/denrlogo.png" alt="DENR-CENRO Diffun" class="logo">
        <div>
          <h1>DENR-CENRO Diffun</h1>
          <p style="font-weight:600">Client Management Dashboard</p>
        </div>
      </div>

    <nav>
        <div class="nav-item active" data-view="client-list" id="nav-client-list">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div>Logged Clients List</div>
        </div>
        
        <a href="index.html" class="nav-item" style="text-decoration: none; color: inherit;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div>Logging Form</div>
        </a>
        </nav>

      <div style="margin-top:auto;font-size:12px;opacity:.95" id="statusContainer">
        <div class="muted">Status:</div>
        <div style="margin-top:6px;font-weight:700">Checking...</div>
      </div>
    </aside>

    <main class="content">
      <div class="topbar">
        <div class="topbar-left">
             <button id="menu-toggle" style="display:none; padding: 8px 10px; background:var(--green-700); border-radius: 8px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3 12h18M3 6h18M3 18h18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div>
              <div class="title">Digital Client Management Dashboard</div>
              <div class="subtitle">DENR-CENRO Diffun</div>
            </div>
        </div>
        <div class="row">
          <div id="realtime-datetime" style="margin-bottom: 0;"></div>
          <button id="syncBtn" class="secondary">Sync List</button>
        </div>
      </div>

      <section id="view-client-list" class="card fade-in">
        <h3>Logged Clients</h3>
        <input type="text" id="search-input" placeholder="Search by Name, Purpose, or Section..." />
        <div id="clientListContainer">Loading...</div>
      </section>
    </main>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- New Sidebar Toggle Logic ---
    const menuToggleBtn = document.getElementById('menu-toggle');
    const sidebar = document.querySelector('.sidebar');
    const app = document.querySelector('.app');

    const toggleSidebar = () => {
        const isOpen = sidebar.classList.toggle('open');
        app.classList.toggle('menu-open');
        
        // Change button icon for better UX
        const icon = menuToggleBtn.querySelector('svg');
        if (isOpen) {
            // X icon (close)
            icon.innerHTML = '<path d="M18 6L6 18M6 6l12 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
        } else {
            // Burger icon (menu)
            icon.innerHTML = '<path d="M3 12h18M3 6h18M3 18h18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
        }
    };
    
    menuToggleBtn.addEventListener('click', toggleSidebar);
    
    // Close sidebar when a nav item is clicked on mobile
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
            if (window.innerWidth <= 600) {
                setTimeout(toggleSidebar, 100); // Small delay to allow navigation to process
            }
        });
    });
    // ------------------------------------

    // Replace this with your deployed Web App URL
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby4gdcxwVmcfUERW0FDEqiFNu0mcGUXiMONI8uNRhdh44MH5bj8f7UIyUh-zl_vqqSvWw/exec';
    
    let allClients = [];
    let initialLoad = true; 

    // State for filtering
    let currentFilter = '';

    // Pagination related variables
    let currentPage = 1;
    const rowsPerPage = 10;

    const navItems = document.querySelectorAll('.nav-item');
    const views = {
        'client-list': document.getElementById('view-client-list')
    };
    const syncBtn = document.getElementById('syncBtn');
    const clientListContainer = document.getElementById('clientListContainer');
    const statusContainer = document.getElementById('statusContainer');
    const realtimeDatetime = document.getElementById('realtime-datetime');
    const splashIntro = document.getElementById('splash-intro');
    const searchInput = document.getElementById('search-input'); 

    // Date formatting options (for re-use)
    const dateOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true };

    // --- Audio Alert Function to say official's name twice (FIXED) ---
    function speakNewClientAlert(section, personnel) {
        if (!('speechSynthesis' in window)) {
            console.warn("Speech Synthesis not supported for client alerts.");
            return;
        }

        // ðŸ’¡ FIX: Cancel any ongoing speech (like the hourly time announcement) to prioritize this alert
        if (window.speechSynthesis.speaking) {
            window.speechSynthesis.cancel();
        }

        const alertMessage = `Attention! A new client has logged in for the ${section} section. Concerned Official: ${personnel}! Concerned Official: ${personnel}! Please attend to the client immediately.`;
        
        const utterance = new SpeechSynthesisUtterance(alertMessage);
        utterance.volume = 1; 
        utterance.rate = 1;   
        
        const voices = window.speechSynthesis.getVoices();
        const preferredVoice = voices.find(voice => voice.name.includes('Google') && voice.lang.includes('en'));

        if (preferredVoice) {
             utterance.voice = preferredVoice;
        } else if (voices.length > 0) {
             utterance.voice = voices[0];
        }

        window.speechSynthesis.speak(utterance);
    }
    // ------------------------------------
    
    // --- SweetAlert Notification Function ---
    function showNewClientSwal(client) {
        const clientName = `${client.firstName || ''} ${client.lastName || ''}`.trim();

        Swal.fire({
            toast: true,
            position: 'top-end', // Displays in the top right corner
            icon: 'info',
            title: 'New Client Logged In',
            html: `
                <div style="text-align: left;">
                    <strong>Client:</strong> ${clientName} <br>
                    <strong>Concerned Section:</strong> ${client.section || 'N/A'} <br>
                    <strong>Concerned Official:</strong> ${client.personnel || 'N/A'}
                </div>
            `,
            showConfirmButton: false,
            timer: 60000, // Disappears after 60 seconds
            timerProgressBar: true
        });
    }
    // ---------------------------------------------

    function switchView(view) {
        navItems.forEach(x => x.classList.remove('active'));
        document.getElementById(`nav-${view}`).classList.add('active');
        for (const k in views) views[k].style.display = (k === view) ? 'block' : 'none';
        if (view === 'client-list') {
             if (allClients.length === 0) loadClientList(false);
             else applyFilterAndRender(false); 
        }
    }
    
    // --- Search Filter Logic ---
    function applyFilterAndRender(resetPage = true) {
        if (resetPage) {
            currentPage = 1; 
        }
        const filterText = currentFilter.toLowerCase();
        
        const filteredClients = allClients.filter(client => {
            if (!filterText) return true; 
            
            const searchPool = [
                client.firstName, 
                client.lastName, 
                client.purpose, 
                client.section, 
                client.personnel,
                client.address
            ].join(' ').toLowerCase();

            return searchPool.includes(filterText);
        });
        
        renderClients(filteredClients);
    }
    
    // Event listener for search input
    searchInput.addEventListener('input', (e) => {
        currentFilter = e.target.value;
        applyFilterAndRender(); 
    });


    // Client List and Sync 
    async function loadClientList(isAutomatic = false) { 
        if (!isAutomatic) {
             clientListContainer.innerHTML = "<div style='text-align:center;'>Loading Client Data...</div>";
        }
       
        if (!isAutomatic) {
            syncBtn.textContent = 'Syncing...';
            syncBtn.classList.add('loading');
        }
        
        let success = true;
        let fetchedClients = [];

        try {
            const res = await fetch(GAS_URL + '?action=list_clients');
            fetchedClients = await res.json();
        } catch(error) {
            fetchedClients = JSON.parse(localStorage.getItem('clients') || '[]');
            console.error("Failed to fetch from server, falling back to local storage.", error);
            if (!isAutomatic) { 
                Swal.fire({
                    icon: 'warning',
                    title: 'Data Load Warning',
                    text: 'Could not connect to the server. Displaying cached (local) data.',
                    confirmButtonColor: '#f59e0b'
                });
            }
            success = false;
        } finally {
             // Stop loading state
            if (!isAutomatic) {
                syncBtn.textContent = 'Sync List';
                syncBtn.classList.remove('loading');
            } else {
                 if(success) {
                     const originalText = 'Sync List';
                     syncBtn.textContent = 'Synced!';
                     setTimeout(() => syncBtn.textContent = originalText, 1000);
                 }
            }
        }
        
        // --- NEW CLIENT DETECTION LOGIC ---
        const existingClientIDs = new Set(allClients.map(c => c.timestamp)); 
        
        fetchedClients.sort((a, b) => {
            const dateA = new Date(a.timestamp);
            const dateB = new Date(b.timestamp);
            return dateB - dateA; 
        });

        const newestClient = fetchedClients[0];

        // Only alert if it's NOT the initial load AND the newest client's timestamp is new
        if (newestClient && !initialLoad && !existingClientIDs.has(newestClient.timestamp)) {
            // 1. Audible Alert (now fixed to prioritize itself)
            speakNewClientAlert(newestClient.section, newestClient.personnel);

            // 2. SweetAlert Notification
            showNewClientSwal(newestClient);
        }
        
        // Update the main list and toggle the initial load flag
        allClients = fetchedClients;
        initialLoad = false;
        // ------------------------------------

        applyFilterAndRender(false); // Do not reset page on sync to maintain user's current view
    }

    // Function to render the pagination controls
    function renderPagination(rows, container) {
        const totalPages = Math.ceil(rows.length / rowsPerPage);
        if (totalPages <= 1) return; 

        const paginationDiv = document.createElement('div');
        paginationDiv.classList.add('pagination-controls');

        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'Previous';
        prevBtn.classList.add('secondary');
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                applyFilterAndRender(false); 
            }
        };
        
        const pageInfo = document.createElement('span');
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'Next';
        nextBtn.classList.add('secondary');
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                applyFilterAndRender(false); 
            }
        };

        paginationDiv.appendChild(prevBtn);
        paginationDiv.appendChild(pageInfo);
        paginationDiv.appendChild(nextBtn);
        container.appendChild(paginationDiv);
    }

    // Toggle Detail Row
    function toggleDetails(button) {
        const tr = button.closest('tr');
        const nextRow = tr.nextElementSibling; 
        
        if (nextRow && nextRow.classList.contains('detail-row')) {
            const isHidden = nextRow.style.display === 'none' || nextRow.style.display === '';
            nextRow.style.display = isHidden ? 'table-row' : 'none';
            button.textContent = isHidden ? 'Hide Details' : 'View Details';
        }
    }


    // Client List Renderer
    function renderClients(rows) {
        if (!rows.length) {
            clientListContainer.innerHTML = currentFilter ? 'No clients found matching your search.' : 'No records yet.';
            return;
        }
        
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;
        const rowsToDisplay = rows.slice(startIndex, endIndex);


        const table = document.createElement('table');
        table.innerHTML = '<thead><tr><th>Name</th><th>Concerned Section/Office</th><th>Concerned Official</th><th>Purpose (Preview)</th><th>Time Logged</th><th>Action</th></tr></thead>';
        const tbody = document.createElement('tbody');
        
        rowsToDisplay.forEach(r => {
            
            // --- 1. TIMESTAMP FORMATTING FIX ---
            const rawTimestamp = r.timestamp || '';
            let formattedTimestamp = rawTimestamp;

            if (rawTimestamp && rawTimestamp.includes('T') && rawTimestamp.includes('Z')) {
                try {
                    const dateObj = new Date(rawTimestamp);
                    formattedTimestamp = dateObj.toLocaleDateString('en-US', dateOptions);
                } catch (e) {
                    // Fallback to raw timestamp
                }
            }
            // ------------------------------------

            // --- 2. PURPOSE TRUNCATION (for main view) ---
            const fullPurpose = r.purpose || 'N/A';
            let displayedPurpose = fullPurpose;
            const words = fullPurpose.split(/\s+/); 
            if (words.length > 5) { 
                displayedPurpose = words.slice(0, 5).join(' ') + '...';
            }
            const purposeCell = `<td title="${fullPurpose}">${displayedPurpose}</td>`;
            // ------------------------------------
            
            // MAIN ROW
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${r.lastName || ''}, ${r.firstName || ''}</td>
              <td>${r.section || ''}</td>
              <td>${r.personnel || ''}</td>
              ${purposeCell}
              <td class="muted">${formattedTimestamp || ''}</td>
              <td><button class="secondary" onclick="toggleDetails(this)">View Details</button></td>
            `;
            tbody.appendChild(tr);

            // DETAIL ROW (Initially hidden)
            const detailTr = document.createElement('tr');
            detailTr.classList.add('detail-row');
            detailTr.style.display = 'none'; 
            detailTr.innerHTML = `
                <td colspan="6">
                    <div class="detail-content">
                        <strong>Full Address:</strong> ${r.address || 'N/A'} <br>
                        <strong>Full Purpose:</strong> ${r.purpose || 'N/A'} <br>
                        <strong>Age:</strong> ${r.age || 'N/A'} &bull; 
                        <strong>Mobile:</strong> ${r.mobile || 'N/A'}
                    </div>
                </td>
            `;
            tbody.appendChild(detailTr);
        });
        
        table.appendChild(tbody);
        clientListContainer.innerHTML = ''; 
        clientListContainer.appendChild(table);
        
        renderPagination(rows, clientListContainer);
    }
    
    // Expose toggleDetails globally for the onclick attribute
    window.toggleDetails = toggleDetails;
    
    syncBtn.addEventListener('click', () => {
        currentFilter = ''; 
        searchInput.value = '';
        loadClientList(false); // Manual sync
    }); 
    
    // Initial data load on startup
    loadClientList(false); 

    // --- Automatic Refresh Logic (10 seconds for faster "live" feel) ---
    // 10000 milliseconds = 10 seconds
    setInterval(() => {
        if (currentFilter === '') {
            loadClientList(true); // Automatic sync
        }
    }, 10000);
    // --------------------------------------------------------

    // Status Check 
    async function checkConnection() {
        try {
            const res = await fetch(GAS_URL);
            if (res.ok) {
                statusContainer.innerHTML = '<div class="muted">Status:</div><div style="color:#22c55e">Connected</div>';
            } else {
                throw new Error('Server not reachable');
            }
        } catch {
            statusContainer.innerHTML = '<div class="muted">Status:</div><div style="color:#ef4444">Not Connected</div>';
        }
    }
    checkConnection();


    // Real-time Date and Time 
    function updateDateTime() {
        const now = new Date();

        const timeOptions = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true };
        const timeString = now.toLocaleTimeString('en-US', timeOptions);
        
        const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const dateString = now.toLocaleDateString('en-US', dateOptions);

        realtimeDatetime.innerHTML = `
            <span class="time-display">${timeString}</span>
            <span class="date-display">${dateString}</span>
        `;
    }

    setInterval(updateDateTime, 1000);
    updateDateTime();
    
    // --- START: HOURLY TIME ANNOUNCEMENT LOGIC ---

    let lastAnnouncedHour = null; 

    function speakTime(hour) {
        const timeString = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
        const textToSpeak = `Attention, the current time is ${timeString}.`;
        
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.volume = 1; 
            utterance.rate = 1;   
            
            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(voice => voice.name.includes('Google') && voice.lang.includes('en'));

            if (preferredVoice) {
                 utterance.voice = preferredVoice;
            } else if (voices.length > 0) {
                 utterance.voice = voices[0];
            }

            window.speechSynthesis.speak(utterance);
        } else {
            console.warn("Speech Synthesis not supported in this browser.");
        }
    }

    function setupHourlyAnnouncements() {
        const now = new Date();
        const currentHour = now.getHours();
        
        if (currentHour !== lastAnnouncedHour) {
            if (now.getMinutes() === 0 && now.getSeconds() < 60) {
                // This check prevents the hourly announcement from interrupting a client alert.
                if (!window.speechSynthesis.speaking) {
                     speakTime(currentHour);
                }
                lastAnnouncedHour = currentHour; 
            }
        }

        setTimeout(setupHourlyAnnouncements, 1000); 
    }
    
    setupHourlyAnnouncements();

    // --- END: HOURLY TIME ANNOUNCEMENT LOGIC ---


    // Splash Screen (Fixed to hide non-destructively)
    setTimeout(() => {
        // Start the fade out
        splashIntro.style.opacity = '0'; 
        
        // After fade out, add the 'hidden' class to fully hide it (visibility: hidden)
        setTimeout(() => {
            splashIntro.classList.add('hidden');
        }, 500); // Matches the CSS transition duration
    }, 1500); // 1.5 seconds display time
});
</script>
</body>
</html>